#!/usr/bin/env zsh

local command="${1:-load}"
shift || true
local -a original_args=("$command" "$@")

case "$command" in
  load)
    @zpm-load-plugins "$@"
    return 0
    ;;

  if)
    local condition="${1:-}"
    shift || true
    if [[ "${is[$condition]}" == '1' ]]; then
      zpm "$@"
    fi
    return 0
    ;;

  if-not)
    local condition="${1:-}"
    shift || true
    if [[ "${is[$condition]}" == '0' ]]; then
      zpm "$@"
    fi
    return 0
    ;;

  u|up|upgrade)
    @zpm-upgrade "$@"
    return 0
    ;;

  c|cl|clean)
    @zpm-clean
    return 0
    ;;
esac

if is-callable "zpm-${command}"; then
  "zpm-${command}" "$@"
  return 0
fi

local joined="${original_args[*]}"
echo "Unknown command \`zpm ${joined}\`, treat as \`zpm load ${joined}\`"
@zpm-load-plugins "${original_args[@]}"
