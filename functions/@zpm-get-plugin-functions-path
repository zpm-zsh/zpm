#!/usr/bin/env zsh

local plugin_spec="$1"
local plugin_path="$2"

if [[ -z "$plugin_path" ]]; then
  return -1
fi

if [[ "$plugin_spec" == 'sindresorhus/pure' ]]; then
  print -r -- "${plugin_path:a}"
  return 0
fi

local candidate
if [[ "$plugin_spec" == *",fpath:"* ]]; then
  candidate="${plugin_path}/${${plugin_spec##*,fpath:}%%,*}"
  [[ -d "$candidate" ]] || return -1
  print -r -- "${candidate:a}"
  return 0
fi

candidate="${plugin_path}/functions"
if [[ -d "$candidate" ]]; then
  print -r -- "${candidate:a}"
  return 0
fi

local file
for file in "$plugin_path"/_*; do
  [[ -e "$file" ]] || continue
  print -r -- "${plugin_path:a}"
  return 0
done

return -1
